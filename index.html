<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MovieRec - Seu App de Recomendações de Filmes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #1a1a1a;
            color: #f0f0f0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: #000;
            color: #fff;
            padding: 1rem 0;
            text-align: center;
        }

        nav {
            display: flex;
            justify-content: center;
            background-color: #333;
            padding: 10px 0;
        }

        nav a {
            color: #f0f0f0;
            text-decoration: none;
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        nav a.active, nav a:hover {
            background-color: #555;
        }

        .page {
            display: none;
            margin-top: 20px;
        }

        .page.active {
            display: block;
        }

        /* Forms de cadastro */
        .registration-form {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
            margin: 40px auto;
        }

        .registration-form h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .registration-form label {
            display: block;
            margin-bottom: 8px;
        }

        .registration-form input[type="text"], .registration-form input[type="number"], .registration-form select {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #444;
            background-color: #333;
            color: #f0f0f0;
            border-radius: 4px;
        }

        .registration-form button {
            width: 100%;
            padding: 12px;
            background-color: #e50914;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }

        /* Cards de filmes */
        .movie-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .movie-card {
            background-color: #2a2a2a;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            text-align: center;
            transition: transform 0.2s;
            cursor: pointer;
        }

        .movie-card:hover {
            transform: translateY(-5px);
        }

        .movie-card img {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }

        .movie-card-content {
            padding: 15px;
        }

        .movie-card-content h3 {
            margin: 0 0 10px;
            font-size: 1.2em;
        }

        .rating-container {
            margin-top: 10px;
        }

        .rating-star {
            font-size: 24px;
            cursor: pointer;
            color: #555;
        }

        .rating-star.rated {
            color: gold;
        }

        /* Detalhes do filme */
        .movie-details {
            display: flex;
            gap: 20px;
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            align-items: flex-start;
        }

        .movie-details img {
            width: 300px;
            border-radius: 8px;
        }

        .movie-details-content {
            flex: 1;
        }

        .movie-details-content h2 {
            margin-top: 0;
        }

        .similar-movies {
            margin-top: 40px;
        }

        /* Filtros e busca */
        .filter-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-section input, .filter-section select {
            padding: 8px;
            border: 1px solid #444;
            background-color: #333;
            color: #f0f0f0;
            border-radius: 4px;
        }

    </style>
</head>
<body>

    <header>
        <h1>MovieRec</h1>
    </header>

    <div class="container">
        <div id="registration-page" class="page active">
            <div class="registration-form">
                <h2>Crie seu perfil</h2>
                <form id="profile-form">
                    <label for="name">Seu Nome:</label>
                    <input type="text" id="name" required>

                    <label for="age">Idade:</label>
                    <input type="number" id="age" required>

                    <label for="favorite-genre">Gênero favorito:</label>
                    <select id="favorite-genre" required>
                        <option value="">Selecione um gênero</option>
                        </select>

                    <button type="submit">Começar</button>
                </form>
            </div>
        </div>

        <div id="main-app" style="display: none;">
            <nav>
                <a href="#inicio" data-page="home-page" class="nav-link active">Início</a>
                <a href="#recomendados" data-page="recommended-page" class="nav-link">Recomendados</a>
                <a href="#explorar" data-page="explore-page" class="nav-link">Explorar</a>
                <a href="#minha-lista" data-page="watchlist-page" class="nav-link">Minha Lista</a>
                <a href="#minhas-notas" data-page="profile-page" class="nav-link">Minhas Notas</a>
                <a href="#busca" data-page="search-page" class="nav-link">Busca</a>
            </nav>

            <div id="home-page" class="page active">
                <h2>Recomendações Iniciais</h2>
                <div id="initial-recommendations" class="movie-grid"></div>
            </div>

            <div id="recommended-page" class="page">
                <h2>Filmes Recomendados para Você</h2>
                <div id="dynamic-recommendations" class="movie-grid"></div>
            </div>

            <div id="explore-page" class="page">
                <h2>Explorar Filmes</h2>
                <div class="filter-section">
                    <input type="text" id="explore-search" placeholder="Buscar por título...">
                    <select id="explore-genre">
                        <option value="">Todos os Gêneros</option>
                        </select>
                    <select id="explore-sort">
                        <option value="popularity">Popularidade</option>
                        <option value="rating">Avaliação Média</option>
                        <option value="release_date">Lançamento</option>
                    </select>
                </div>
                <div id="explore-results" class="movie-grid"></div>
            </div>

            <div id="movie-details-page" class="page">
                <div id="movie-details-container"></div>
                <div class="similar-movies">
                    <h3>Filmes Similares</h3>
                    <div id="similar-movies-grid" class="movie-grid"></div>
                </div>
            </div>

            <div id="watchlist-page" class="page">
                <h2>Minha Lista</h2>
                <div id="watchlist-grid" class="movie-grid"></div>
            </div>

            <div id="profile-page" class="page">
                <h2>Minhas Avaliações</h2>
                <div id="profile-notes-grid" class="movie-grid"></div>
                <h3>Estatísticas de Gêneros</h3>
                <div id="genre-stats"></div>
            </div>

            <div id="search-page" class="page">
                <h2>Busca</h2>
                <div class="filter-section">
                    <input type="text" id="search-input" placeholder="Buscar filmes...">
                    <button onclick="handleSearch()">Buscar</button>
                </div>
                <div id="search-results" class="movie-grid"></div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = 'SUA_CHAVE_API_TMDB'; // Substitua pela sua chave da API do TMDB

        const movieData = [
            { id: 1, title: 'O Vingador Silencioso', genre: 'Ação', popularity: 0.9, rating: 4.5, release_date: '2023-01-15', poster: 'https://image.tmdb.org/t/p/w500/A31P5vE7r1fG9E8K6p92L1u2eK3.jpg' },
            { id: 2, title: 'O Último Suspiro', genre: 'Drama', popularity: 0.8, rating: 4.7, release_date: '2022-05-20', poster: 'https://image.tmdb.org/t/p/w500/rC0e5L3iQ4y5Jz6H6y4T7F2E2b7.jpg' },
            { id: 3, title: 'A Sombra no Labirinto', genre: 'Suspense', popularity: 0.75, rating: 4.2, release_date: '2024-02-10', poster: 'https://image.tmdb.org/t/p/w500/yK9qM1T9iR0tT4j4D5F8b4R3w8G.jpg' },
            { id: 4, title: 'Fúria Espacial', genre: 'Ficção Científica', popularity: 0.95, rating: 4.8, release_date: '2023-11-01', poster: 'https://image.tmdb.org/t/p/w500/oF9O6X9J5l5Z5L4x8F4w2D2g2C5.jpg' },
            { id: 5, title: 'O Jardim Esquecido', genre: 'Romance', popularity: 0.6, rating: 4.0, release_date: '2022-09-05', poster: 'https://image.tmdb.org/t/p/w500/i9n4Q1Z8Y3q7p5E9x3f6n4l5T4J.jpg' },
            { id: 6, title: 'A Maldição da Floresta', genre: 'Terror', popularity: 0.7, rating: 3.9, release_date: '2024-03-22', poster: 'https://image.tmdb.org/t/p/w500/s9j8o8Q1G7b7H9m3p8G2r4c1p6A.jpg' },
            { id: 7, title: 'A Lenda do Dragão', genre: 'Aventura', popularity: 0.88, rating: 4.6, release_date: '2023-08-10', poster: 'https://image.tmdb.org/t/p/w500/o7j4m7Z3o2z1n9r7p7v4y2D5h3S.jpg' },
            { id: 8, title: 'Comédia da Meia-Noite', genre: 'Comédia', popularity: 0.72, rating: 4.1, release_date: '2022-07-30', poster: 'https://image.tmdb.org/t/p/w500/o7j4m7Z3o2z1n9r7p7v4y2D5h3S.jpg' },
        ];

        let sessionData = {
            user: null,
            ratings: {}, // { movieId: rating }
            watchlist: [],
        };

        const genres = ['Ação', 'Drama', 'Suspense', 'Ficção Científica', 'Romance', 'Terror', 'Aventura', 'Comédia'];

        // Funções de utilidade
        const showPage = (pageId) => {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            document.querySelector(`[data-page="${pageId}"]`).classList.add('active');
        };

        const sigmoid = (x) => 1 / (1 + Math.exp(-x));

        const getGenreStats = () => {
            const stats = {};
            genres.forEach(g => {
                stats[g] = { count: 0, sum: 0, average: 0 };
            });
            for (const id in sessionData.ratings) {
                const movie = movieData.find(m => m.id === parseInt(id));
                if (movie) {
                    const genre = movie.genre;
                    const rating = sessionData.ratings[id];
                    stats[genre].count++;
                    stats[genre].sum += rating;
                }
            }
            for (const genre in stats) {
                if (stats[genre].count > 0) {
                    stats[genre].average = stats[genre].sum / stats[genre].count;
                }
            }
            return stats;
        };

        const getRecommendationScore = (movie) => {
            if (!sessionData.user) return movie.popularity;

            const genreStats = getGenreStats();
            const genreAvg = genreStats[movie.genre] ? genreStats[movie.genre].average : 0;
            const genreWeight = (genreAvg / 5) || 0.5; // Pondera a avaliação do gênero

            const popularityWeight = movie.popularity;
            const userSimilarity = (movie.genre === sessionData.user.favoriteGenre) ? 1.5 : 1;

            const score = sigmoid(userSimilarity * genreWeight + popularityWeight);
            return Math.min(100, Math.floor(score * 100));
        };

        const renderMovieCard = (movie, containerId, probability = null) => {
            const container = document.getElementById(containerId);
            const card = document.createElement('div');
            card.className = 'movie-card';
            card.onclick = () => showMovieDetails(movie.id);

            const posterUrl = movie.poster;

            let probabilityHtml = '';
            if (probability !== null) {
                probabilityHtml = `<p><strong>${probability}%</strong> de chance de gostar</p>`;
            }

            const isRated = sessionData.ratings[movie.id] !== undefined;
            const currentRating = isRated ? sessionData.ratings[movie.id] : 0;
            const ratingHtml = `
                <div class="rating-container" data-movie-id="${movie.id}">
                    ${[1, 2, 3, 4, 5].map(star => `
                        <span class="rating-star ${star <= currentRating ? 'rated' : ''}" data-value="${star}">★</span>
                    `).join('')}
                </div>
            `;

            card.innerHTML = `
                <img src="${posterUrl}" alt="${movie.title} poster">
                <div class="movie-card-content">
                    <h3>${movie.title}</h3>
                    <p>Gênero: ${movie.genre}</p>
                    ${probabilityHtml}
                    ${ratingHtml}
                </div>
            `;
            container.appendChild(card);
            
            // Adicionar evento para as estrelas
            card.querySelectorAll('.rating-star').forEach(star => {
                star.addEventListener('click', (e) => {
                    e.stopPropagation(); // Evita que o clique no card seja acionado
                    const value = parseInt(e.target.dataset.value);
                    const movieId = parseInt(e.target.closest('.rating-container').dataset.movieId);
                    handleRating(movieId, value);
                });
            });
        };

        const handleRating = (movieId, rating) => {
            sessionData.ratings[movieId] = rating;
            
            // Re-renderiza a página atual para atualizar as estrelas
            const currentPage = document.querySelector('.page.active').id;
            if (currentPage === 'recommended-page') {
                renderRecommendedMovies();
            } else if (currentPage === 'profile-page') {
                renderProfilePage();
            } else if (currentPage === 'movie-details-page') {
                showMovieDetails(movieId);
            }
            
            // Re-calcula recomendações
            renderRecommendations();
            alert(`Você avaliou o filme ${movieData.find(m => m.id === movieId).title} com ${rating} estrelas.`);
        };

        const renderInitialRecommendations = () => {
            const container = document.getElementById('initial-recommendations');
            container.innerHTML = '';
            const initialMovies = movieData.sort((a, b) => b.popularity - a.popularity).slice(0, 6);
            initialMovies.forEach(movie => renderMovieCard(movie, 'initial-recommendations'));
        };

        const renderRecommendations = () => {
            if (!sessionData.user) return;

            const container = document.getElementById('dynamic-recommendations');
            container.innerHTML = '';

            const ratedMovieIds = Object.keys(sessionData.ratings).map(Number);
            const unratedMovies = movieData.filter(m => !ratedMovieIds.includes(m.id));

            const recommended = unratedMovies
                .map(movie => ({
                    ...movie,
                    score: getRecommendationScore(movie)
                }))
                .sort((a, b) => b.score - a.score)
                .slice(0, 10);

            recommended.forEach(movie => {
                renderMovieCard(movie, 'dynamic-recommendations', movie.score);
            });
        };

        const renderExplorePage = (searchQuery = '', genreFilter = '', sortMethod = 'popularity') => {
            const container = document.getElementById('explore-results');
            container.innerHTML = '';

            let filteredMovies = movieData;
            
            if (searchQuery) {
                filteredMovies = filteredMovies.filter(movie => movie.title.toLowerCase().includes(searchQuery.toLowerCase()));
            }

            if (genreFilter) {
                filteredMovies = filteredMovies.filter(movie => movie.genre === genreFilter);
            }

            if (sortMethod === 'popularity') {
                filteredMovies.sort((a, b) => b.popularity - a.popularity);
            } else if (sortMethod === 'rating') {
                filteredMovies.sort((a, b) => b.rating - a.rating);
            } else if (sortMethod === 'release_date') {
                filteredMovies.sort((a, b) => new Date(b.release_date) - new Date(a.release_date));
            }

            filteredMovies.forEach(movie => renderMovieCard(movie, 'explore-results'));
        };

        const showMovieDetails = (movieId) => {
            const movie = movieData.find(m => m.id === movieId);
            if (!movie) return;

            const container = document.getElementById('movie-details-container');
            container.innerHTML = `
                <img src="${movie.poster}" alt="${movie.title} poster">
                <div class="movie-details-content">
                    <h2>${movie.title}</h2>
                    <p><strong>Gênero:</strong> ${movie.genre}</p>
                    <p><strong>Lançamento:</strong> ${movie.release_date}</p>
                    <p><strong>Avaliação Média:</strong> ${movie.rating} / 5</p>
                    <p><strong>Sinopse:</strong> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                    <button onclick="addToWatchlist(${movie.id})">Adicionar à Minha Lista</button>
                    <div class="rating-container" data-movie-id="${movie.id}">
                        <p>Avalie este filme:</p>
                        ${[1, 2, 3, 4, 5].map(star => `
                            <span class="rating-star ${star <= sessionData.ratings[movie.id] ? 'rated' : ''}" data-value="${star}">★</span>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // Adicionar evento para as estrelas
            container.querySelectorAll('.rating-star').forEach(star => {
                star.addEventListener('click', (e) => {
                    const value = parseInt(e.target.dataset.value);
                    handleRating(movieId, value);
                });
            });

            renderSimilarMovies(movie);
            showPage('movie-details-page');
        };

        const renderSimilarMovies = (currentMovie) => {
            const container = document.getElementById('similar-movies-grid');
            container.innerHTML = '';
            
            const similar = movieData
                .filter(m => m.id !== currentMovie.id && m.genre === currentMovie.genre)
                .sort((a, b) => b.popularity - a.popularity)
                .slice(0, 4);

            similar.forEach(movie => renderMovieCard(movie, 'similar-movies-grid'));
        };

        const addToWatchlist = (movieId) => {
            if (!sessionData.watchlist.includes(movieId)) {
                sessionData.watchlist.push(movieId);
                alert('Filme adicionado à sua lista!');
            } else {
                alert('Este filme já está na sua lista.');
            }
        };

        const renderWatchlist = () => {
            const container = document.getElementById('watchlist-grid');
            container.innerHTML = '';
            if (sessionData.watchlist.length === 0) {
                container.innerHTML = '<p>Sua lista está vazia. Adicione filmes para vê-los aqui!</p>';
                return;
            }
            const watchlistMovies = sessionData.watchlist.map(id => movieData.find(m => m.id === id));
            watchlistMovies.forEach(movie => renderMovieCard(movie, 'watchlist-grid'));
        };

        const renderProfilePage = () => {
            const notesContainer = document.getElementById('profile-notes-grid');
            notesContainer.innerHTML = '';
            
            const ratedMovieIds = Object.keys(sessionData.ratings).map(Number);
            if (ratedMovieIds.length === 0) {
                 notesContainer.innerHTML = '<p>Você ainda não avaliou nenhum filme. Suas notas aparecerão aqui.</p>';
            } else {
                const ratedMovies = ratedMovieIds.map(id => movieData.find(m => m.id === id));
                ratedMovies.forEach(movie => renderMovieCard(movie, 'profile-notes-grid'));
            }

            const statsContainer = document.getElementById('genre-stats');
            statsContainer.innerHTML = '';
            const genreStats = getGenreStats();
            let statsHtml = '<ul>';
            for (const genre in genreStats) {
                if (genreStats[genre].count > 0) {
                    statsHtml += `<li><strong>${genre}:</strong> Avaliação Média ${genreStats[genre].average.toFixed(1)} (${genreStats[genre].count} filmes)</li>`;
                }
            }
            statsHtml += '</ul>';
            statsContainer.innerHTML = statsHtml;
        };

        const handleSearch = () => {
            const query = document.getElementById('search-input').value;
            const resultsContainer = document.getElementById('search-results');
            resultsContainer.innerHTML = '';

            if (query.length < 3) {
                resultsContainer.innerHTML = '<p>Digite pelo menos 3 caracteres para buscar.</p>';
                return;
            }

            const searchResults = movieData.filter(movie => movie.title.toLowerCase().includes(query.toLowerCase()));
            if (searchResults.length > 0) {
                searchResults.forEach(movie => renderMovieCard(movie, 'search-results'));
            } else {
                resultsContainer.innerHTML = '<p>Nenhum filme encontrado.</p>';
            }
        };

        // Event Listeners
        document.getElementById('profile-form').addEventListener('submit', (e) => {
            e.preventDefault();
            sessionData.user = {
                name: document.getElementById('name').value,
                age: document.getElementById('age').value,
                favoriteGenre: document.getElementById('favorite-genre').value,
            };
            document.getElementById('registration-page').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            renderInitialRecommendations();
            renderRecommendations();
        });

        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                const pageId = e.target.dataset.page;
                showPage(pageId);
                if (pageId === 'recommended-page') {
                    renderRecommendations();
                } else if (pageId === 'explore-page') {
                    renderExplorePage();
                } else if (pageId === 'watchlist-page') {
                    renderWatchlist();
                } else if (pageId === 'profile-page') {
                    renderProfilePage();
                }
            });
        });

        document.getElementById('explore-search').addEventListener('input', (e) => {
            const query = e.target.value;
            const genre = document.getElementById('explore-genre').value;
            const sort = document.getElementById('explore-sort').value;
            renderExplorePage(query, genre, sort);
        });

        document.getElementById('explore-genre').addEventListener('change', (e) => {
            const query = document.getElementById('explore-search').value;
            const genre = e.target.value;
            const sort = document.getElementById('explore-sort').value;
            renderExplorePage(query, genre, sort);
        });

        document.getElementById('explore-sort').addEventListener('change', (e) => {
            const query = document.getElementById('explore-search').value;
            const genre = document.getElementById('explore-genre').value;
            const sort = e.target.value;
            renderExplorePage(query, genre, sort);
        });

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            const genreSelect = document.getElementById('favorite-genre');
            const exploreGenreSelect = document.getElementById('explore-genre');
            genres.forEach(genre => {
                const option = document.createElement('option');
                option.value = genre;
                option.textContent = genre;
                genreSelect.appendChild(option);
                
                const exploreOption = document.createElement('option');
                exploreOption.value = genre;
                exploreOption.textContent = genre;
                exploreGenreSelect.appendChild(exploreOption);
            });
        });

    </script>
</body>
</html>