# app.py

from flask import Flask, render_template_string, request, redirect, url_for, session
import random
import math

app = Flask(__name__)
app.secret_key = 'super_secret_key' # Chave secreta para gerenciar sessões

# Dados fictícios de filmes
FILMES = {
'1': {'titulo': 'Aventura nas Estrelas', 'generos': ['Ficção Científica', 'Aventura'], 'poster_url':
'https://picsum.photos/300/450?random=1'},
'2': {'titulo': 'O Último Cavaleiro', 'generos': ['Ação', 'Fantasia'], 'poster_url':
'https://picsum.photos/300/450?random=2'},
'3': {'titulo': 'Romance em Paris', 'generos': ['Romance', 'Comédia'], 'poster_url':
'https://picsum.photos/300/450?random=3'},
'4': {'titulo': 'Código da Mente', 'generos': ['Suspense', 'Drama'], 'poster_url':
'https://picsum.photos/300/450?random=4'},
'5': {'titulo': 'Mistério na Floresta', 'generos': ['Suspense', 'Aventura'], 'poster_url':
'https://picsum.photos/300/450?random=5'},
'6': {'titulo': 'Heróis do Futuro', 'generos': ['Ação', 'Ficção Científica'], 'poster_url':
'https://picsum.photos/300/450?random=6'},
'7': {'titulo': 'Um Dia de Sol', 'generos': ['Comédia', 'Romance'], 'poster_url':
'https://picsum.photos/300/450?random=7'},
'8': {'titulo': 'O Despertar da Magia', 'generos': ['Fantasia', 'Aventura'], 'poster_url':
'https://picsum.photos/300/450?random=8'},
'9': {'titulo': 'A Invasão Silenciosa', 'generos': ['Ficção Científica', 'Suspense'], 'poster_url':
'https://picsum.photos/300/450?random=9'},
'10': {'titulo': 'Vida de um Pintor', 'generos': ['Drama', 'Biografia'], 'poster_url':
'https://picsum.photos/300/450?random=10'},
'11': {'titulo': 'Corrida Mortal', 'generos': ['Ação', 'Aventura'], 'poster_url':
'https://picsum.photos/300/450?random=11'},
'12': {'titulo': 'Amor à Segunda Vista', 'generos': ['Romance', 'Comédia'], 'poster_url':
'https://picsum.photos/300/450?random=12'},
'13': {'titulo': 'Segredos da Família', 'generos': ['Drama', 'Mistério'], 'poster_url':
'https://picsum.photos/300/450?random=13'},
'14': {'titulo': 'Cyber-Guerreiros', 'generos': ['Ação', 'Ficção Científica'], 'poster_url':
'https://picsum.photos/300/450?random=14'},
'15': {'titulo': 'O Mistério do Castelo', 'generos': ['Aventura', 'Fantasia'], 'poster_url':
'https://picsum.photos/300/450?random=15'},
}

GENEROS = sorted(list(set(g for f in FILMES.values() for g in f['generos'])))

# Funções do sistema de recomendação

def sigmoid(x):
return 1 / (1 + math.exp(-x))

def calcular_probabilidade(filme, usuario_generos, avaliacoes):
# Baseado na similaridade de gênero e popularidade (simulada)
generos_comuns = set(filme['generos']).intersection(set(usuario_generos))
similaridade = len(generos_comuns) / len(filme['generos']) if filme['generos'] else 0

# Simula uma pontuação de popularidade e a adiciona à similaridade
popularidade_simulada = random.uniform(0.1, 0.5)
pontuacao = (similaridade * 3) + popularidade_simulada

# Aplica a função sigmoide para converter a pontuação em uma porcentagem
probabilidade = sigmoid(pontuacao) * 100

# Penaliza filmes já avaliados
for filme_id, avaliacao in avaliacoes.items():
if filme_id == filme_id:
probabilidade *= 0.1 # Reduz a chance de recomendar algo já visto
break

return max(0, min(100, probabilidade))

def get_recomendacoes(usuario_generos, avaliacoes):
recomendacoes_gerais = []

for filme_id, filme_info in FILMES.items():
if filme_id not in avaliacoes: # Não recomenda filmes já avaliados
probabilidade = calcular_probabilidade(filme_info, usuario_generos, avaliacoes)
motivo = f"Com base nos seus gostos por {', '.join(filme_info['generos'])}"

# Adiciona um motivo mais específico se houver similaridade
if len(set(filme_info['generos']).intersection(set(usuario_generos))) > 0:
generos_comuns = set(filme_info['generos']).intersection(set(usuario_generos))
motivo = f"Você gostou de {', '.join(generos_comuns)}, e este filme é do mesmo gênero."

recomendacoes_gerais.append({
'id': filme_id,
'titulo': filme_info['titulo'],
'poster_url': filme_info['poster_url'],
'generos': filme_info['generos'],
'probabilidade': int(probabilidade),
'motivo': motivo
})

# Ordena por probabilidade em ordem decrescente
recomendacoes_gerais.sort(key=lambda x: x['probabilidade'], reverse=True)
return recomendacoes_gerais

# Rotas do Flask e templates embutidos

@app.route('/', methods=['GET', 'POST'])
def cadastro():
if request.method == 'POST':
nome = request.form.get('nome')
idade = request.form.get('idade')
generos_selecionados = request.form.getlist('generos')

session['usuario'] = {
'nome': nome,
'idade': idade,
'generos': generos_selecionados,
}
session['avaliacoes'] = {}
session['watchlist'] = []
return redirect(url_for('home'))

html = """
<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bem-Vindo!</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .container {
            background-color: white;
            padding: 2em;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 90%;
            text-align: center;
        }

        h1 {
            color: #1a73e8;
            margin-bottom: 0.5em;
        }

        p {
            color: #666;
            margin-bottom: 1.5em;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 1em;
            text-align: left;
        }

        label {
            font-weight: 600;
            color: #444;
        }

        input[type="text"],
        input[type="number"] {
            padding: 0.8em;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            width: calc(100% - 1.6em);
        }

        .generos-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5em;
        }

        .generos-grid label {
            display: flex;
            align-items: center;
            font-weight: normal;
            cursor: pointer;
        }

        input[type="checkbox"] {
            margin-right: 0.5em;
        }

        button {
            background-color: #1a73e8;
            color: white;
            padding: 0.8em;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 1em;
        }

        button:hover {
            background-color: #155bb5;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Filmes Recomendados</h1>
        <p>Comece preenchendo seu perfil para receber as melhores recomendações.</p>
        <form method="post">
            <label for="nome">Nome:</label>
            <input type="text" id="nome" name="nome" required>
            <label for="idade">Idade:</label>
            <input type="number" id="idade" name="idade" required>
            <label>Gêneros de Filmes Favoritos:</label>
            <div class="generos-grid">
                {% for genero in generos %}
                <label><input type="checkbox" name="generos" value="{{ genero }}">{{ genero }}</label>
                {% endfor %}
            </div>
            <button type="submit">Começar a Explorar</button>
        </form>
    </div>
</body>

</html>
"""
return render_template_string(html, generos=GENEROS)

def base_html(title, content, active_page=''):
nav_links = [
('home', 'Início'),
('recomendados', 'Recomendados'),
('explorar', 'Explorar'),
('watchlist', 'Minha Lista'),
('perfil', 'Minhas Notas'),
('busca', 'Busca'),
]

html = f"""
<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{title}</title>
    <style>
        body {

            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            margin: 0;

        }

        .header {

            background-color: white;
            padding: 1em;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;

        }

        .logo {

            font-size: 1.5em;
            font-weight: bold;
            color: #1a73e8;
            text-decoration: none;

        }

        .nav {

            display: flex;
            gap: 1.5em;

        }

        .nav a {

            text-decoration: none;
            color: #555;
            font-weight: 500;
            padding: 0.5em 0;
            transition: color 0.3s;

        }

        .nav a.active {

            color: #1a73e8;
            border-bottom: 2px solid #1a73e8;

        }

        .nav a:hover {

            color: #1a73e8;

        }

        .content {

            padding: 2em;
            max-width: 1200px;
            margin: 0 auto;

        }

        h1 {

            color: #1a73e8;
            margin-bottom: 1em;

        }

        .movie-grid {

            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5em;

        }

        .movie-card {

            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            text-align: center;

        }

        .movie-card img {

            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 12px 12px 0 0;

        }

        .card-info {

            padding: 1em;
            display: flex;
            flex-direction: column;
            flex-grow: 1;

        }

        .card-info h3 {

            margin-top: 0;
            margin-bottom: 0.5em;
            font-size: 1.1em;

        }

        .card-info p {

            font-size: 0.9em;
            color: #666;
            margin: 0;
            flex-grow: 1;

        }

        .card-probabilidade {

            font-weight: bold;
            color: #1a73e8;
            margin-top: 0.5em;

        }

        .rating-form {

            margin-top: 1em;
            display: flex;
            justify-content: center;

        }

        .rating-form select {

            padding: 0.5em;
            border-radius: 6px;
            border: 1px solid #ddd;

        }

        .rating-form button {

            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 0.5em 1em;
            border-radius: 6px;
            cursor: pointer;
            margin-left: 0.5em;

        }

        .detail-container {

            display: flex;
            gap: 2em;
            align-items: flex-start;

        }

        .detail-container img {

            width: 300px;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);

        }

        .detail-info {

            flex: 1;

        }

        .detail-info h1 {

            margin-top: 0;

        }

        .tag {

            background-color: #e6e6e6;
            padding: 0.3em 0.8em;
            border-radius: 12px;
            font-size: 0.8em;
            margin-right: 0.5em;
            color: #555;
            display: inline-block;
            margin-bottom: 0.5em;

        }

        .profile-stats {

            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1em;
            margin-top: 1em;

        }

        .stat-card {

            background-color: white;
            padding: 1em;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);

        }

        .stat-card h3 {

            color: #1a73e8;
            margin-top: 0;

        }

        .search-form {

            display: flex;
            gap: 0.5em;
            margin-bottom: 2em;

        }

        .search-form input {

            flex-grow: 1;
            padding: 0.8em;
            border: 1px solid #ddd;
            border-radius: 8px;

        }

        .search-form button {

            background-color: #1a73e8;
            color: white;
            padding: 0.8em 1.5em;
            border: none;
            border-radius: 8px;
            cursor: pointer;

        }
    </style>
</head>

<body>
    <header class="header">
        <a href="/" class="logo">Recomenda Filmes</a>
        <nav class="nav">
            {% for endpoint, name in nav_links %}
            <a href="{{ url_for(endpoint) }}" class="{{ 'active' if active_page == endpoint else '' }}">{{ name }}</a>
            {% endfor %}
        </nav>
    </header>
    <main class="content">
        {content}
    </main>
</body>

</html>
"""
return html

@app.route('/home')
def home():
if 'usuario' not in session:
return redirect(url_for('cadastro'))

usuario = session['usuario']
avaliacoes = session.get('avaliacoes', {})
recomendacoes = get_recomendacoes(usuario['generos'], avaliacoes)[:6]

html_content = f"""
<h1>Bem-vindo(a), {usuario['nome']}!</h1>
<p>Aqui estão algumas recomendações iniciais com base nos seus gêneros favoritos: {', '.join(usuario['generos'])}.</p>
<div class="movie-grid">
    {% for filme in recomendacoes %}
    <div class="movie-card">
        <a href="{{ url_for('detalhes', filme_id=filme.id) }}"><img src="{{ filme.poster_url }}"
                alt="{{ filme.titulo }}"></a>
        <div class="card-info">
            <h3><a href="{{ url_for('detalhes', filme_id=filme.id) }}" style="text-decoration: none; color: inherit;">{{
                    filme.titulo }}</a></h3>
            <p>{{ filme.motivo }}</p>
            <span class="card-probabilidade">{{ filme.probabilidade }}% de você gostar</span>
            <form action="{{ url_for('avaliar') }}" method="post" class="rating-form">
                <input type="hidden" name="filme_id" value="{{ filme.id }}">
                <select name="avaliacao">
                    <option value="1">⭐</option>
                    <option value="2">⭐⭐</option>
                    <option value="3">⭐⭐⭐</option>
                    <option value="4">⭐⭐⭐⭐</option>
                    <option value="5">⭐⭐⭐⭐⭐</option>
                </select>
                <button type="submit">Avaliar</button>
            </form>
        </div>
    </div>
    {% endfor %}
</div>
"""
return render_template_string(base_html('Início', html_content, 'home'), recomendacoes=recomendacoes)

@app.route('/avaliar', methods=['POST'])
def avaliar():
filme_id = request.form.get('filme_id')
avaliacao = int(request.form.get('avaliacao'))
if 'avaliacoes' not in session:
session['avaliacoes'] = {}

# Atualiza a avaliação e a "popularidade" do filme
session['avaliacoes'][filme_id] = {
'avaliacao': avaliacao,
'titulo': FILMES[filme_id]['titulo']
}

# Recalcula as recomendações após a avaliação
session.modified = True
return redirect(url_for('recomendados'))

@app.route('/recomendados')
def recomendados():
if 'usuario' not in session:
return redirect(url_for('cadastro'))

usuario = session['usuario']
avaliacoes = session.get('avaliacoes', {})

recomendacoes_dinamicas = get_recomendacoes(usuario['generos'], avaliacoes)

html_content = f"""
<h1>Recomendações Dinâmicas</h1>
<p>Nossas sugestões se ajustaram com base nas suas avaliações recentes!</p>
<div class="movie-grid">
    {% for filme in recomendacoes_dinamicas %}
    <div class="movie-card">
        <a href="{{ url_for('detalhes', filme_id=filme.id) }}"><img src="{{ filme.poster_url }}"
                alt="{{ filme.titulo }}"></a>
        <div class="card-info">
            <h3><a href="{{ url_for('detalhes', filme_id=filme.id) }}" style="text-decoration: none; color: inherit;">{{
                    filme.titulo }}</a></h3>
            <p>{{ filme.motivo }}</p>
            <span class="card-probabilidade">{{ filme.probabilidade }}% de você gostar</span>
            <form action="{{ url_for('avaliar') }}" method="post" class="rating-form">
                <input type="hidden" name="filme_id" value="{{ filme.id }}">
                <select name="avaliacao">
                    <option value="1">⭐</option>
                    <option value="2">⭐⭐</option>
                    <option value="3">⭐⭐⭐</option>
                    <option value="4">⭐⭐⭐⭐</option>
                    <option value="5">⭐⭐⭐⭐⭐</option>
                </select>
                <button type="submit">Avaliar</button>
            </form>
        </div>
    </div>
    {% endfor %}
</div>
"""
return render_template_string(base_html('Recomendados', html_content, 'recomendados'),
recomendacoes_dinamicas=recomendacoes_dinamicas)

@app.route('/explorar')
def explorar():
if 'usuario' not in session:
return redirect(url_for('cadastro'))

sort_by = request.args.get('sort', 'titulo')
genre_filter = request.args.get('genre', 'all')

filmes_filtrados = [
{'id': fid, **finfo}
for fid, finfo in FILMES.items()
if genre_filter == 'all' or genre_filter in finfo['generos']
]

if sort_by == 'titulo':
filmes_filtrados.sort(key=lambda x: x['titulo'])
elif sort_by == 'generos':
filmes_filtrados.sort(key=lambda x: x['generos'][0] if x['generos'] else '')

html_content = f"""
<h1>Explorar Filmes</h1>
<div class="search-form" style="margin-bottom: 1em; align-items: center;">
    <label for="sort_by">Ordenar por:</label>
    <select id="sort_by"
        onchange="window.location.href = '?sort=' + this.value + '&genre={{ request.args.get('genre', 'all') }}'">
        <option value="titulo" {{ 'selected' if sort_by=='titulo' else '' }}>Título</option>
        <option value="generos" {{ 'selected' if sort_by=='generos' else '' }}>Gênero</option>
    </select>
    <label for="genre_filter" style="margin-left: 1em;">Filtrar por Gênero:</label>
    <select id="genre_filter"
        onchange="window.location.href = '?sort={{ request.args.get('sort', 'titulo') }}' + '&genre=' + this.value">
        <option value="all" {{ 'selected' if genre_filter=='all' else '' }}>Todos</option>
        {% for genero in generos %}
        <option value="{{ genero }}" {{ 'selected' if genre_filter==genero else '' }}>{{ genero }}</option>
        {% endfor %}
    </select>
</div>
<div class="movie-grid">
    {% for filme in filmes %}
    <div class="movie-card">
        <a href="{{ url_for('detalhes', filme_id=filme.id) }}"><img src="{{ filme.poster_url }}"
                alt="{{ filme.titulo }}"></a>
        <div class="card-info">
            <h3><a href="{{ url_for('detalhes', filme_id=filme.id) }}" style="text-decoration: none; color: inherit;">{{
                    filme.titulo }}</a></h3>
            <p>{{ ', '.join(filme.generos) }}</p>
        </div>
    </div>
    {% endfor %}
</div>
"""
return render_template_string(base_html('Explorar', html_content, 'explorar'), filmes=filmes_filtrados, generos=GENEROS,
sort_by=sort_by, genre_filter=genre_filter)

@app.route('/detalhes/<filme_id>')
    def detalhes(filme_id):
    filme = FILMES.get(filme_id)
    if not filme:
    return "Filme não encontrado", 404

    recomendacoes_similares = [
    {'id': fid, **finfo}
    for fid, finfo in FILMES.items()
    if set(filme['generos']).intersection(finfo['generos']) and fid != filme_id
    ][:4]

    html_content = f"""
    <div class="detail-container">
        <img src="{{ filme.poster_url }}" alt="{{ filme.titulo }}">
        <div class="detail-info">
            <h1>{{ filme.titulo }}</h1>
            <p><strong>Gêneros:</strong> {% for genero in filme.generos %}<span class="tag">{{ genero }}</span>{% endfor
                %}</p>
            <p><strong>Sinopse (Fictícia):</strong> Este é um filme sobre uma emocionante jornada que explora temas de
                amizade, coragem e superação. Prepare-se para uma aventura inesquecível!</p>
            <form action="{{ url_for('adicionar_watchlist', filme_id=filme.id) }}" method="post"
                style="margin-top: 2em;">
                <button type="submit">Adicionar à Minha Lista</button>
            </form>
        </div>
    </div>
    <div style="margin-top: 4em;">
        <h2>Filmes Similares</h2>
        <div class="movie-grid">
            {% for filme_sim in similares %}
            <div class="movie-card">
                <a href="{{ url_for('detalhes', filme_id=filme_sim.id) }}"><img src="{{ filme_sim.poster_url }}"
                        alt="{{ filme_sim.titulo }}"></a>
                <div class="card-info">
                    <h3><a href="{{ url_for('detalhes', filme_id=filme_sim.id) }}"
                            style="text-decoration: none; color: inherit;">{{ filme_sim.titulo }}</a></h3>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    """
    return render_template_string(base_html(filme['titulo'], html_content), filme=filme,
    similares=recomendacoes_similares)

    @app.route('/adicionar_watchlist/<filme_id>', methods=['POST'])
        def adicionar_watchlist(filme_id):
        if 'watchlist' not in session:
        session['watchlist'] = []

        if filme_id not in session['watchlist']:
        session['watchlist'].append(filme_id)
        session.modified = True

        return redirect(url_for('watchlist'))

        @app.route('/watchlist')
        def watchlist():
        if 'watchlist' not in session:
        session['watchlist'] = []

        filmes_watchlist = [
        {'id': fid, **FILMES[fid]} for fid in session['watchlist'] if fid in FILMES
        ]

        html_content = f"""
        <h1>Minha Lista de Filmes</h1>
        <p>Filmes que você salvou para assistir depois.</p>
        {% if not filmes %}
        <p>Sua lista está vazia. Adicione filmes na página de Detalhes!</p>
        {% else %}
        <div class="movie-grid">
            {% for filme in filmes %}
            <div class="movie-card">
                <a href="{{ url_for('detalhes', filme_id=filme.id) }}"><img src="{{ filme.poster_url }}"
                        alt="{{ filme.titulo }}"></a>
                <div class="card-info">
                    <h3><a href="{{ url_for('detalhes', filme_id=filme.id) }}"
                            style="text-decoration: none; color: inherit;">{{ filme.titulo }}</a></h3>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        """
        return render_template_string(base_html('Minha Lista', html_content, 'watchlist'), filmes=filmes_watchlist)

        @app.route('/perfil')
        def perfil():
        if 'avaliacoes' not in session:
        return redirect(url_for('cadastro'))

        avaliacoes = session['avaliacoes']

        # Gera um perfil de gosto baseado nas avaliações
        generos_notas = {}
        for filme_id, info in avaliacoes.items():
        filme_generos = FILMES.get(filme_id, {}).get('generos', [])
        for genero in filme_generos:
        generos_notas[genero] = generos_notas.get(genero, {'soma': 0, 'count': 0})
        generos_notas[genero]['soma'] += info['avaliacao']
        generos_notas[genero]['count'] += 1

        perfil_por_genero = {
        genero: round(info['soma'] / info['count'], 1)
        for genero, info in generos_notas.items()
        }

        html_content = f"""
        <h1>Minhas Notas e Perfil</h1>
        <p>Seu perfil de gosto com base nos filmes que você avaliou.</p>
        <div class="profile-stats">
            {% for genero, nota in perfil %}
            <div class="stat-card">
                <h3>{{ genero }}</h3>
                <p>Nota média: <strong>{{ nota }} / 5</strong></p>
            </div>
            {% endfor %}
        </div>
        <div style="margin-top: 2em;">
            <h2>Meus Filmes Avaliados</h2>
            <ul>
                {% for filme_id, info in avaliacoes.items() %}
                <li><strong>{{ info.titulo }}</strong> - Nota: {{ info.avaliacao }} ⭐</li>
                {% endfor %}
            </ul>
        </div>
        """
        return render_template_string(base_html('Minhas Notas', html_content, 'perfil'),
        perfil=perfil_por_genero.items(), avaliacoes=avaliacoes)

        @app.route('/busca', methods=['GET'])
        def busca():
        query = request.args.get('q', '').lower()
        resultados = [
        {'id': fid, **finfo}
        for fid, finfo in FILMES.items()
        if query in finfo['titulo'].lower() or any(query in g.lower() for g in finfo['generos'])
        ]

        html_content = f"""
        <h1>Buscar Filmes</h1>
        <form action="{{ url_for('busca') }}" method="get" class="search-form">
            <input type="text" name="q" placeholder="Buscar por título ou gênero..." value="{{ query }}">
            <button type="submit">Buscar</button>
        </form>

        {% if query and not resultados %}
        <p>Nenhum resultado encontrado para "{{ query }}".</p>
        {% elif resultados %}
        <h2>Resultados da Busca</h2>
        <div class="movie-grid">
            {% for filme in resultados %}
            <div class="movie-card">
                <a href="{{ url_for('detalhes', filme_id=filme.id) }}"><img src="{{ filme.poster_url }}"
                        alt="{{ filme.titulo }}"></a>
                <div class="card-info">
                    <h3><a href="{{ url_for('detalhes', filme_id=filme.id) }}"
                            style="text-decoration: none; color: inherit;">{{ filme.titulo }}</a></h3>
                    <p>{{ ', '.join(filme.generos) }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        """
        return render_template_string(base_html('Busca', html_content, 'busca'), resultados=resultados, query=query)

        if __name__ == '__main__':
        app.run(debug=True)